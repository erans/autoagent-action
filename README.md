# AutoAgent

A composable GitHub Action that integrates with AI agents like [Cursor CLI](https://cursor.sh) to run prompts on a repository as part of Pull Request workflows.

## Features

- **Predefined Rules**: Run curated rules like OWASP security checks or refactoring suggestions
- **Custom Prompt Support**: Extend analysis with team-specific custom instructions
- **Agent Auto Installation**: Automatically installs the agent unless explicitly disabled
- **Multiple Agents Support**: Pluggable agent support, starting with `cursor`
- **PR Comment Output**: Posts results back to GitHub PR comments in a structured format

## Usage

### Basic Example

```yaml
name: AutoAgent Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  autoagent:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run AutoAgent
        uses: erans/autoagent@v1
        with:
          rules: |
            - owasp-check
            - code-review
          custom: |
            Please check for inefficient SQL queries and suggest optimizations.
          action: comment
          install-agent: true
          agent: cursor
```

### Advanced Example

```yaml
name: AutoAgent Security & Quality Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  autoagent:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run AutoAgent
        uses: erans/autoagent@v1
        with:
          rules: |
            - owasp-check
            - code-review
            - refactor-suggestions
          custom: |
            Please analyze the database schema changes and ensure they follow our naming conventions.
            Also check for any potential performance issues with the new queries.
          action: comment
          install-agent: true
          agent: cursor
```

### Custom Prompt Only Example

```yaml
name: AutoAgent Custom Analysis

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  autoagent:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run AutoAgent
        uses: erans/autoagent@v1
        with:
          custom: |
            Please review this pull request for:
            1. Code quality and best practices
            2. Security vulnerabilities
            3. Performance optimizations
            4. Documentation completeness
          action: comment
          install-agent: true
          agent: cursor
```

## Inputs

| Input | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `rules` | String (YAML/JSON list) | ‚ùå No | `[]` | Predefined rules to execute |
| `custom` | String | ‚ùå No | `""` | Custom prompt to append to predefined rules |
| `action` | Enum | ‚úÖ Yes | `comment` | What to do with results (currently `comment` only) |
| `install-agent` | Boolean | ‚ùå No | `true` | Whether to install the agent automatically |
| `agent` | String | ‚ùå No | `cursor` | Which agent to use |

## Predefined Rules

| Rule Name | Description |
|-----------|-------------|
| `owasp-check` | Security scan based on OWASP Top 10 guidelines |
| `code-review` | Performs a general AI-driven code review |
| `refactor-suggestions` | Detects code smells and suggests refactors |

## Output

The action posts structured results to the GitHub PR as comments:

```
### ü§ñ AutoAgent Results

**Rule:** `owasp-check`
```
No critical security issues detected.
```

**Rule:** `code-review`
```
Found 2 potential improvements in the authentication logic.
```

**Rule:** `custom`
```
Database queries look optimized. Consider adding indexes for the new columns.
```

---
*Generated by [AutoAgent](https://github.com/erans/autoagent) v1.0*
```

## Requirements

- GitHub CLI (`gh`) must be available in the runner environment
- For YAML parsing: `yq` (optional, falls back to `jq`)
- For JSON parsing: `jq`

## Error Handling

The action will fail gracefully with descriptive error messages for:
- Missing rule files
- Agent installation failures
- Invalid input formats
- Missing required tools

## License

MIT License - see LICENSE file for details.
