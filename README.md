# AutoAgent

> **‚ö†Ô∏è Experimental Project**: This project was created during a hackathon at the Cursor offices on September 10, 2025. Use at your own risk. Future updates will focus on making it production CI/CD ready. üöß  - Thank you to the Curosr team for hosting!

A composable GitHub Action that integrates with AI agents like [Cursor CLI](https://cursor.com/cli) to run prompts on a repository as part of Pull Request workflows.

## Features

- **Predefined Rules**: Run curated rules like OWASP security checks or refactoring suggestions
- **Custom Prompt Support**: Extend analysis with team-specific custom instructions
- **Agent Auto Installation**: Automatically installs the agent unless explicitly disabled
- **Multiple Agents Support**: Pluggable agent support, starting with `cursor`
- **PR Comment Output**: Posts results back to GitHub PR comments in a structured format

## Usage

### Basic Example

```yaml
name: AutoAgent Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  autoagent:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run AutoAgent
        uses: erans/autoagent@v1
        env:
          CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}
        with:
          rules: |
            - owasp-check
            - code-review
          custom: |
            Please check for inefficient SQL queries and suggest optimizations.
          action: comment
          install-agent: true
          agent: cursor
```

### Advanced Example

```yaml
name: AutoAgent Security & Quality Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  autoagent:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run AutoAgent
        uses: erans/autoagent@v1
        env:
          CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}
        with:
          rules: |
            - owasp-check
            - code-review
            - refactor-suggestions
            - duplication-check
          custom: |
            Please analyze the database schema changes and ensure they follow our naming conventions.
            Also check for any potential performance issues with the new queries.
          action: comment
          install-agent: true
          agent: cursor
```

### Custom Prompt Only Example

```yaml
name: AutoAgent Custom Analysis

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  autoagent:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run AutoAgent
        uses: erans/autoagent@v1
        env:
          CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}
        with:
          custom: |
            Please review this pull request for:
            1. Code quality and best practices
            2. Security vulnerabilities
            3. Performance optimizations
            4. Documentation completeness
          action: comment
          install-agent: true
          agent: cursor
```

## Inputs

| Input | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `rules` | String (YAML/JSON list) | ‚ùå No | `[]` | Predefined rules to execute |
| `custom` | String | ‚ùå No | `""` | Custom prompt to append to predefined rules |
| `action` | Enum | ‚úÖ Yes | `comment` | What to do with results (currently `comment` only) |
| `install-agent` | Boolean | ‚ùå No | `true` | Whether to install the agent automatically |
| `agent` | String | ‚ùå No | `cursor` | Which agent to use |

## Predefined Rules

| Rule Name | Description |
|-----------|-------------|
| `owasp-check` | Security scan based on OWASP Top 10 guidelines |
| `code-review` | Performs a general AI-driven code review |
| `refactor-suggestions` | Detects code smells and suggests refactors |
| `duplication-check` | Identifies code duplication and suggests existing code reuse |

## Output

The action posts structured results to the GitHub PR as comments:

```
### ü§ñ AutoAgent Results

**Rule:** `owasp-check`
```
No critical security issues detected.
```

**Rule:** `code-review`
```
Found 2 potential improvements in the authentication logic.
```

**Rule:** `custom`
```
Database queries look optimized. Consider adding indexes for the new columns.
```

---
*Generated by [AutoAgent](https://github.com/erans/autoagent) v1.0*
```

## Requirements

- GitHub CLI (`gh`) must be available in the runner environment
- For YAML parsing: `yq` (optional, falls back to `jq`)
- For JSON parsing: `jq`
- **Cursor API Key** - Required for cursor-agent to work (add as repository secret `CURSOR_API_KEY`)

## Environment Variables

- **`CURSOR_API_KEY`** - Required for Cursor CLI authentication
- **`MODEL`** - Optional AI model to use (defaults to `gpt-5`)

## Permissions

The action requires the following GitHub token permissions:

```yaml
permissions:
  contents: read
  pull-requests: write
  issues: write
```

Add this to your workflow file to ensure the action can post comments to pull requests.

## Setup

### 1. Add Cursor API Key

The action requires the `CURSOR_API_KEY` environment variable to be set as a repository secret.

#### Steps to add the secret:

1. **Get your Cursor API key**:
   - Open Cursor IDE
   - Go to Settings (Cmd/Ctrl + ,)
   - Navigate to **General** ‚Üí **Account**
   - Copy your API key from the account section

2. **Add the secret to your repository**:
   - Go to your GitHub repository
   - Click **Settings** (in the repository toolbar)
   - In the left sidebar, click **Secrets and variables** ‚Üí **Actions**
   - Click **New repository secret**
   - Name: `CURSOR_API_KEY`
   - Value: Paste your Cursor API key
   - Click **Add secret**

**Important**: The API key must be added as a repository secret, not as an environment variable in the workflow file directly.

### 2. Add Workflow Permissions

Add the permissions block to your workflow file (see Permissions section above).

## Error Handling

The action will fail gracefully with descriptive error messages for:
- Missing rule files
- Agent installation failures
- Invalid input formats
- Missing required tools

## License

MIT License - see LICENSE file for details.
